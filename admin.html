<!DOCTYPE html>
  <script>
    // Basit eri≈üim kontrol√º: "duflat-access" anahtarƒ± "granted" deƒüilse login.html'e y√∂nlendir
    if (localStorage.getItem("duflat-access") !== "granted") {
      window.location.href = "login.html";
    }
  </script>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="page-title">≈ûehir</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
      overflow-y: auto;
      background-color: #f5f5f5;
    }
    .logo {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 28px;
      text-decoration: none;
      color: black;
    }
    h1 {
      font-size: 26px;
      margin-top: 80px;
      margin-bottom: 30px;
    }
    .city-section {
      margin-bottom: 30px;
      background-color: white;
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
      max-width: 1000px;
      margin-left: auto;
      margin-right: auto;
    }
    .city-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }
    .city-title {
      margin: 0;
      font-size: 20px;
      color: #0077cc;
    }
    .city-photos {
      display: flex;
      gap: 15px;
      overflow-x: auto;
      padding: 5px 0;
      scroll-snap-type: x mandatory;
      scrollbar-width: none;
    }
    .city-photos::-webkit-scrollbar {
      display: none;
    }
    .photo-card {
      flex: 0 0 auto;
      width: 200px;
      height: 200px;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0,0,0,0.12);
      scroll-snap-align: start;
      background-color: white;
      position: relative;
    }
    .photo-card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .back-link {
      margin-top: 30px;
      display: inline-block;
      color: #0077cc;
      text-decoration: none;
    }
    .back-link:hover {
      text-decoration: underline;
    }
    .location-link {
      text-decoration: underline;
      color: #0077cc;
      display: flex;
      align-items: center;
    }
    .location-link:hover {
      text-decoration: underline;
      text-decoration-thickness: 2px;
    }
    .click-icon {
      margin-right: 5px;
      display: inline-block;
    }
    .click-icon::before {
      content: "‚û§";
      display: inline-block;
    }
    /* ====== EDƒ∞T√ñR PANEL ====== */
    .edit-panel {
      position: fixed;
      top: 20px;
      right: 20px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      z-index: 1000;
      max-height: 80vh;
      overflow-y: auto;
      display: none;
    }
    .edit-panel h3 { margin-top: 0; color: #333; }
    .edit-panel input, .edit-panel button, .edit-panel textarea {
      margin: 5px 0;
      padding: 6px;
      width: 100%;
      box-sizing: border-box;
    }
    .edit-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #0077cc;
      color: white;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      cursor: pointer;
      font-size: 24px;
      z-index: 1000;
    }
    .export-btn {
      background: #28a745;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 8px;
      cursor: pointer;
      margin-top: 8px;
    }
    #exportedCode {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border: 1px solid #ddd;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      z-index: 2000;
      width: 80%;
      max-width: 800px;
      max-height: 80vh;
      overflow-y: auto;
    }
    #exportedCode pre {
      background: #f5f5f5;
      padding: 10px;
      border-radius: 5px;
      overflow-x: auto;
    }
    #bulkLocations { font-family: monospace; resize: vertical; }
  </style>
</head>
<body>
  <!-- üåê Logo baƒülantƒ±sƒ± -->
  <a href="https://duflat.com/main.html" class="logo">üåê duflat.com</a>
  <h1 id="city-header">üì∏ <span id="city-name"></span></h1>
  <!-- Konumlar dinamik olarak burada g√∂r√ºnecek -->
  <div id="locations-container"></div>
  <p><a href="turkiye.html" class="back-link">‚Üê T√ºrkiye'ye d√∂n</a></p>

  <!-- EDƒ∞T√ñR PANEL TETƒ∞K BUTONU -->
  <button class="edit-btn" onclick="toggleEditPanel()">‚úé</button>

  <!-- ===== EDƒ∞T√ñR PANEL ===== -->
  <div class="edit-panel" id="editPanel">
    <h3>‚öôÔ∏è ≈ûehir Ayarlarƒ±</h3>
    <input type="text" id="cityName" placeholder="≈ûehir Adƒ±">
    <button onclick="updateCityName()">≈ûehir Adƒ±nƒ± G√ºncelle</button>
    <button onclick="resetLocalStorage()" style="background:#dc3545;color:white;">T√ºm Veriyi Sƒ±fƒ±rla</button>
    <h3>üìù Konum Ekle (Toplu)</h3>
    <textarea id="bulkLocations" rows="10" placeholder="Her satƒ±ra bir konum ekleyin. Format: KonumAdƒ±@@GoogleMapsLink@@Foto1@@Foto2@@Foto3"></textarea>
    <button onclick="addBulkLocations()">Toplu Ekle</button>
    <button onclick="clearAll()">T√ºm√ºn√º Temizle</button>
    <button class="export-btn" onclick="exportHTML()">HTML Kodunu Kopyala</button>
    <button onclick="toggleEditPanel()">Kapat</button>
  </div>

  <!-- ===== KOD √ñNƒ∞ZLEME / KOPYALAMA ===== -->
  <div id="exportedCode">
    <h3>HTML Kodunuz:</h3>
    <pre id="codeOutput"></pre>
    <button onclick="copyCode()">Kopyala</button>
    <button onclick="hideExportedCode()">Kapat</button>
  </div>

<script>
  /* ------------ Yardƒ±mcƒ± Fonksiyonlar ------------ */
  function getCityFromUrl() {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get('city') || '≈ûehir';
  }
  function storageKey() { return `locations_${getCityFromUrl()}`; }
  function cityNameKey() { return `cityName_${getCityFromUrl()}`; }

  /* ------------ ≈ûehir Adƒ± ------------ */
  function loadCityName() {
    return localStorage.getItem(cityNameKey()) || getCityFromUrl();
  }
  function saveCityName(name) {
    localStorage.setItem(cityNameKey(), name);
  }

  /* ------------ Konumlar ------------ */
  function loadLocations() {
    const data = localStorage.getItem(storageKey());
    return data ? JSON.parse(data) : [];
  }
  function saveLocations(arr) {
    localStorage.setItem(storageKey(), JSON.stringify(arr));
  }

  /* ------------ Sayfa G√ºncelle ------------ */
  function updatePageTitle() {
    const name = loadCityName();
    document.getElementById('city-name').textContent = name;
    document.getElementById('page-title').textContent = name;
  }

  /* ------------ Render ------------ */
  function renderLocations() {
    const container = document.getElementById('locations-container');
    const locations = loadLocations();
    container.innerHTML = '';
    locations.forEach(loc => {
      const section = document.createElement('div');
      section.className = 'city-section';
      // Fotoƒüraflar
      let photosHTML = '';
      loc.photos.forEach(url => {
        photosHTML += `<div class="photo-card"><img src="${url}" alt="${loc.name}"></div>`;
      });
      section.innerHTML = `
        <div class="city-header">
          <h2 class="city-title"><a href="${loc.link}" target="_blank" class="location-link"><span class="click-icon"></span>${loc.name} üìç</a></h2>
        </div>
        <div class="city-photos">${photosHTML}</div>`;
      container.appendChild(section);
    });
  }

  /* ------------ Toplu Konum Ekle ------------ */
  function addBulkLocations() {
    const txt = document.getElementById('bulkLocations').value.trim();
    if (!txt) { alert('L√ºtfen konum bilgilerini girin!'); return; }
    const lines = txt.split('\n').filter(l=>l.trim());
    const locations = loadLocations();
    let added = 0;
    lines.forEach((line,i)=>{
      let clean = line.replace(/^\d+\.\s*/, '');
      const parts = clean.split('@@');
      if (parts.length < 2) return;
      const name = parts[0].trim();
      const link = parts[1].trim();
      const photos = parts.slice(2,5).filter(p=>p.trim().startsWith('http'));
      locations.push({name, link, photos});
      added++;
    });
    saveLocations(locations);
    renderLocations();
    document.getElementById('bulkLocations').value = '';
    alert(`${added} konum eklendi.`);
  }

  /* ------------ Temizle & Sƒ±fƒ±rla ------------ */
  function clearAll() {
    if (confirm('T√ºm konumlarƒ± silmek istediƒüinizden emin misiniz?')) {
      localStorage.removeItem(storageKey());
      renderLocations();
    }
  }
  function resetLocalStorage() {
    if (confirm('T√ºm kaydedilen veriyi silmek istediƒüinizden emin misiniz?')) {
      localStorage.removeItem(storageKey());
      localStorage.removeItem(cityNameKey());
      location.reload();
    }
  }

  /* ------------ ≈ûehir Adƒ± Deƒüi≈ütir ------------ */
  function updateCityName() {
    const newName = document.getElementById('cityName').value.trim();
    if (newName) { saveCityName(newName); updatePageTitle(); }
  }

  /* ------------ Edit Panel ------------ */
  function toggleEditPanel() {
    const p = document.getElementById('editPanel');
    p.style.display = (p.style.display==='block') ? 'none' : 'block';
    if (p.style.display==='block') {
      document.getElementById('cityName').value = loadCityName();
    }
  }

  /* ------------ Export ------------ */
  function exportHTML() {
    const cityName = loadCityName();
    const locations = loadLocations();

    let locationsHTML = '';
    locations.forEach(loc=>{
      let photosHTML = '';
      loc.photos.forEach(u=>{photosHTML += `<div class="photo-card"><img src="${u}" alt="${loc.name}"></div>`;});
      locationsHTML += `
  <div class="city-section">
    <div class="city-header">
      <h2 class="city-title"><a href="${loc.link}" target="_blank" class="location-link"><span class="click-icon"></span>${loc.name} üìç</a></h2>
    </div>
    <div class="city-photos">${photosHTML}</div>
  </div>`;
    });

    const fullHTML = `<!DOCTYPE html>
  <script>
    if (localStorage.getItem('duflat-access') !== 'granted') {
      window.location.href = 'login.html';
    }
  </script>
<html lang='tr'>
<head>
  <meta charset='UTF-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
  <title>${cityName}</title>
  <style>/* aynƒ± stiller */${document.querySelector('style').innerHTML}</style>
</head>
<body>
  <a href='https://duflat.com/main.html' class='logo'>üåê duflat.com</a>
  <h1>üì∏ ${cityName}</h1>
  ${locationsHTML}
  <p><a href='turkiye.html' class='back-link'>‚Üê T√ºrkiye'ye d√∂n</a></p>
</body>
</html>`;

    document.getElementById('codeOutput').textContent = fullHTML;
    document.getElementById('exportedCode').style.display = 'block';
  }
  function copyCode() {
    navigator.clipboard.writeText(document.getElementById('codeOutput').textContent).then(()=>alert('Kod kopyalandƒ±!'));
  }
  function hideExportedCode() { document.getElementById('exportedCode').style.display='none'; }

  /* ------------ ƒ∞lk Y√ºkleme ------------ */
  window.onload = ()=>{ updatePageTitle(); renderLocations(); };
</script>
</body>
</html>
