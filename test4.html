<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Maps Konum Edit√∂r√º</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        body { margin:0; font-family:Arial, sans-serif; }
        #map { height: 100vh; width:100%; }
        .custom-marker {
            background: #ff4444;
            border: 2px solid white;
            border-radius: 50%;
            width: 14px;
            height: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <h2>üìÅ CSV Y√ºkle</h2>
    <input type="file" id="csvFile" accept=".csv">
    <button id="exportBtn">üì§ Export HTML</button>
    <div id="map"></div>

    <script>
        const map = L.map('map').setView([20, 0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

        let markers = [];
        let locations = [];

        // Koordinat √ßƒ±karƒ±cƒ±
        function extractCoordinates(url){
            if(!url) return null;
            let m = url.match(/@(-?\d+\.\d+),(-?\d+\.\d+)/);
            if(m) return {lat:parseFloat(m[1]), lng:parseFloat(m[2])};
            m = url.match(/!3d(-?\d+\.\d+)!4d(-?\d+\.\d+)/);
            if(m) return {lat:parseFloat(m[1]), lng:parseFloat(m[2])};
            return null;
        }

        document.getElementById("csvFile").addEventListener("change", e=>{
            const file = e.target.files[0];
            if(!file) return;
            markers.forEach(m => map.removeLayer(m));
            markers = [];
            locations = [];

            Papa.parse(file, {
                delimiter: ";", // CSV T√ºrk√ße Excel i√ßin
                skipEmptyLines: true,
                complete: function(results){
                    results.data.forEach((row,i)=>{
                        const name = row[0];   // A1 = isim
                        const url  = row[1];   // A2 = link
                        const coords = extractCoordinates(url);
                        if(coords){
                            locations.push({name, url, lat:coords.lat, lng:coords.lng});

                            const marker = L.circleMarker([coords.lat, coords.lng], {
                                radius: 6, fillColor:"red", color:"#fff", weight:2, opacity:1, fillOpacity:0.9
                            }).addTo(map);

                            marker.on("click", ()=>{ window.open(url, "_blank"); });
                            markers.push(marker);
                        }
                    });

                    if(markers.length>0){
                        const group = L.featureGroup(markers);
                        map.fitBounds(group.getBounds().pad(0.1));
                    } else {
                        alert("Hi√ß ge√ßerli konum bulunamadƒ±!");
                    }
                }
            });
        });

        // Export butonu
        document.getElementById("exportBtn").addEventListener("click", ()=>{
            if(locations.length===0){ alert("Konum yok!"); return; }

            const htmlContent = `
<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Exported Map</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"><\/script>
<style>body{margin:0;}#map{height:100vh;}</style>
</head>
<body>
<div id="map"></div>
<script>
const map = L.map('map').setView([20,0],2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
    attribution:'¬© OpenStreetMap contributors'
}).addTo(map);
const locations = ${JSON.stringify(locations)};
let markers=[];
locations.forEach(loc=>{
    const m = L.circleMarker([loc.lat, loc.lng],{
        radius:6, fillColor:"red", color:"#fff", weight:2, opacity:1, fillOpacity:0.9
    }).addTo(map);
    m.on("click", ()=>{ window.open(loc.url, "_blank"); });
    markers.push(m);
});
if(markers.length>0){
    const g = L.featureGroup(markers);
    map.fitBounds(g.getBounds().pad(0.1));
}
<\/script>
</body>
</html>`;
            navigator.clipboard.writeText(htmlContent);
            alert("‚úÖ HTML kodu panoya kopyalandƒ±!");
        });
    </script>
</body>
</html>
